<h1>01 - Acceleration</h1>

<div id="sim-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>


<script>
// Инициализация сцены, камеры и рендерера
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(900, 900);
    renderer.setClearColor(0xcccccc);
    document.body.appendChild(renderer.domElement);

    // Настройка камеры
    camera.position.set(0, 5, 10);
    camera.lookAt(0, 0, 0);

    // Добавление освещения
    const ambientLight = new THREE.AmbientLight(0x404040, 0.8);
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.9);
    directionalLight.position.set(5, 10, 7);
    scene.add(directionalLight);

    // Создание плоской поверхности (пола)
    const floorGeometry = new THREE.PlaneGeometry(20, 20);
    const floorMaterial = new THREE.MeshStandardMaterial({ 
        color: 0x888888,
        roughness: 0.8,
        metalness: 0.2
    });
    const floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.rotation.x = -Math.PI / 2; // Поворачиваем плоскость горизонтально
    floor.position.y = -2;
    floor.receiveShadow = true; // Включаем тени для пола
    scene.add(floor);

    // Создание шарика
    const ballGeometry = new THREE.SphereGeometry(0.5, 32, 32);
    const ballMaterial = new THREE.MeshStandardMaterial({
        color: 0x0074d9,
        roughness: 0.5,
        metalness: 1
    });
    const ball = new THREE.Mesh(ballGeometry, ballMaterial);
    ball.position.set(0, 5, 0); // Начальная позиция выше пола
    ball.castShadow = true; // Включаем тени для шарика
    scene.add(ball);

    // Физические параметры
    let velocity = new THREE.Vector3(0, 0, 0); // Начальная скорость
    const gravity = -9.8; // Ускорение свободного падения
    const damping = 0; // Коэффициент упругости (отскок)
    let isDropping = true;

    // Функция анимации
    function animate() {
        requestAnimationFrame(animate);

        if (isDropping) {
            // Применяем гравитацию
            velocity.y += gravity * 0.016; // 0.016 ≈ 1/60 (60 FPS)
            
            // Обновляем позицию шарика
            ball.position.add(velocity.clone().multiplyScalar(0.016));

            // Проверка столкновения с полом
            if (ball.position.y - 0.5 <= floor.position.y) {
                ball.position.y = floor.position.y + 0.5; // Корректируем позицию
                velocity.y = -velocity.y * damping; // Отскок
                
                // Если скорость после отскока маленькая - останавливаем анимацию
                if (Math.abs(velocity.y) < 0.1) {
                    velocity.y = 0;
                    isDropping = false;
                }
            }
        }

        // Вращение шарика для эффекта движения
        if (isDropping) {
            ball.rotation.x += velocity.y * 0.01;
            ball.rotation.z += velocity.y * 0.005;
        }

        renderer.render(scene, camera);
    }

    // Обработка изменения размера окна
    window.addEventListener('resize', () => {
        //camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(900, 900);
    });

    // Запуск анимации
    animate();

    // Добавим возможность сброса анимации по клику
    window.addEventListener('click', () => {
        ball.position.set(0, 5, 0);
        velocity.set(0, 0, 0);
        ball.rotation.set(0, 0, 0);
        isDropping = true;
    });

    document.querySelector('#sim-container').appendChild(renderer.domElement);
</script>